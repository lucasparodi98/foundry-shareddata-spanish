{"_id":"1TneUGShSgOdDpEF","name":"MacroRayo Debilitador","permission":{"default":0,"WEA9QcckcU0S7gTI":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.IgfMFdoXRYNU0x8N"},"cf":{"id":"temp_96l9k5fzhdo"}},"scope":"global","command":"//DAE Macro Execute, Effect Value = \"Macro Name\" @target \n\nlet target = canvas.tokens.get(args[1]);\nlet weapons = target.actor.items.filter(i => i.data.type === `weapon`);\n\n/**\n * For every str weapon, update the damage formulas to half the damage, set flag of original\n */\nif (args[0] === \"on\") {\n    for (let weapon of weapons) {\n        if (weapon.abilityMod === \"str\") {\n            let newWeaponParts = duplicate(weapon.data.data.damage.parts);\n            weapon.setFlag('world', 'RayOfEnfeeblement', newWeaponParts);\n            for (let part of weapon.data.data.damage.parts) {\n                part[0] = `floor((${part[0]})/2)`;\n            }\n            weapon.update({ \"data.damage.parts\": weapon.data.data.damage.parts });\n        }\n    }\n}\n\n// Update weapons to old value\nif (args[0] === \"off\") {\n    for (let weapon of weapons) {\n        let parts = weapon.getFlag('world', 'RayOfEnfeeblement');\n\n        weapon.update({ \"data.damage.parts\": parts });\n    }\n}","author":"WEA9QcckcU0S7gTI","img":"systems/dnd5e/icons/spells/beam-jade-2.jpg","actorIds":[]}
{"_id":"2tmNi2sQaJW8tGrW","name":"MacroHoja de Fuego","permission":{"default":0,"WEA9QcckcU0S7gTI":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.SlQPN9cea6VW9R5d"},"cf":{"id":"temp_96l9k5fzhdo","path":"Macros Conjuros","color":"#800000"}},"scope":"global","command":"//DAE Macro Execute, Effect Value = \"Macro Name\" @target @item.level\n\nlet target = canvas.tokens.get(args[1])\nlet data = {}\n/**\n * Create Flame Blade item in inventory\n */\nif (args[0] === \"on\") {\n  let weaponDamge = 2 + Math.floor(args[2] / 2);\n  await target.actor.createOwnedItem(\n    {\n      \"name\": \"Hoja de Fuego Invocada\",\n      \"type\": \"weapon\",\n      \"data\": {\n        \"quantity\": 1,\n        \"activation\": {\n          \"type\": \"action\",\n          \"cost\": 1,\n          \"condition\": \"\"\n        },\n        \"duration\": {\n          \"value\": null,\n          \"units\": \"\"\n        },\n        \"target\": {\n          \"value\": 1,\n          \"width\": null,\n          \"units\": \"\",\n          \"type\": \"creature\"\n        },\n        \"range\": {\n          \"value\": 5,\n          \"long\": null,\n          \"units\": \"\"\n        },\n        \"uses\": {\n          \"value\": 0,\n          \"max\": 0,\n          \"per\": \"\"\n        },\n        \"consume\": {\n          \"type\": \"\",\n          \"target\": \"\",\n          \"amount\": null\n        },\n        \"ability\": \"\",\n        \"actionType\": \"msak\",\n        \"attackBonus\": \"0\",\n        \"chatFlavor\": \"\",\n        \"critical\": null,\n        \"damage\": {\n          \"parts\": [\n            [\n              `${weaponDamge}d6`,\n              \"fire\"\n            ]\n          ],\n          \"versatile\": \"\"\n        },\n        \"weaponType\": \"simpleM\",\n        \"proficient\": true,\n      },\n      \"img\": \"systems/dnd5e/icons/spells/enchant-orange-2.jpg\",\n    }\n  );\n}\n\n// Delete Flame Blade\nif (args[0] === \"off\") {\n  let item = target.actor.data.items.find(i => i.name === \"Hoja de Fuego Invocada\" && i.type === \"weapon\")\n  target.actor.deleteOwnedItem(item._id)\n}","author":"WEA9QcckcU0S7gTI","img":"systems/dnd5e/icons/spells/enchant-orange-2.jpg","actorIds":[]}
{"_id":"4dOP46gKhOyCSbu2","name":"MacroCanalizar Divinidad: Arma Sagrada","permission":{"default":0,"WEA9QcckcU0S7gTI":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.6avU8avuuue4Q8hE"},"cf":{"id":"temp_96l9k5fzhdo"}},"scope":"global","command":"//DAE Macro Execute, Effect Value = \"Macro Name\" @target\n\nlet target = canvas.tokens.get(args[1]);\nlet weapons = target.actor.items.filter(i => i.data.type === `weapon`);\nlet weapon_content = ``;\nfunction value_limit(val, min, max) {\n    return val < min ? min : (val > max ? max : val);\n}\n\n//Filter for weapons\nfor (let weapon of weapons) {\n    weapon_content += `<option value=${weapon.id}>${weapon.name}</option>`;\n}\n\n/**\n * Select for weapon and apply bonus based on spell level\n */\nif (args[0] === \"on\") {\n    let content = `\n    <div class=\"form-group\">\n    <label>Armas : </label>\n    <select name=\"weapons\">\n        ${weapon_content}\n        </select>\n    </div>`;\n\n    new Dialog({\n        content,\n        buttons:\n        {\n            Ok:\n            {\n                label: `Okey`,\n                callback: (html) => {\n                    let itemId = html.find('[name=weapons]')[0].value;\n                    let item = target.actor.items.get(itemId);\n                    let copy_item = duplicate(item);\n                    let bonus = args[2];\n                    target.actor.setFlag(`world`, `canalizarDivinidadArmaSagrada`, {\n                        damage: item.data.attackBonus,\n                        weapon: itemId,\n                    }\n                    );\n                    copy_item.data.attackBonus = (copy_item.data.attackBonus + bonus);\n                    target.actor.updateEmbeddedEntity(\"OwnedItem\", copy_item);\n                }\n            },\n            Cancel:\n            {\n                label: `Cancelar`\n            }\n        }\n    }).render(true);\n}\n\n//Revert weapon and unset flag.\nif (args[0] === \"off\") {\n    let { damage, weapon, weaponDmg } = target.actor.getFlag('world', 'canalizarDivinidadArmaSagrada');\n    let item = target.actor.items.get(weapon);\n    let copy_item = duplicate(item);\n    copy_item.data.attackBonus = (copy_item.data.attackBonus - damage);\n    target.actor.updateEmbeddedEntity(\"OwnedItem\", copy_item);\n    target.actor.unsetFlag(`world`, `canalizarDivinidadArmaSagrada`);\n}","author":"WEA9QcckcU0S7gTI","img":"systems/dnd5e/icons/skills/light_05.jpg","actorIds":[]}
{"_id":"4xWLqACO3owo6tFT","name":"MacroVeneno Básico","permission":{"default":0,"pBwbFiG4dBGPbe9o":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.6avU8avuuue4Q8hE"},"cf":{"id":"temp_96l9k5fzhdo","path":"Macros Conjuros","import":null}},"scope":"global","command":"//DAE Macro Execute, Effect Value = \"Macro Name\" @target\n\nlet target = canvas.tokens.get(args[1]);\nlet weapons = target.actor.items.filter(i => i.data.type === `weapon`);\nlet weapon_content = ``;\n\n//Filter for weapons\nfor (let weapon of weapons) {\n    weapon_content += `<option value=${weapon.id}>${weapon.name}</option>`;\n}\n\n/**\n * Select for weapon and apply bonus based on spell level\n */\nif (args[0] === \"on\") {\n    let content = `\n    <div class=\"form-group\">\n    <label>Armas : </label>\n    <select name=\"weapons\">\n        ${weapon_content}\n        </select>\n    </div>`;\n\n    new Dialog({\n        content,\n        buttons:\n        {\n            Ok:\n            {\n                label: `Okey`,\n                callback: (html) => {\n                    let itemId = html.find('[name=weapons]')[0].value;\n                    let item = target.actor.items.get(itemId);\n                    let copy_item = duplicate(item);\n                    let wpDamage = copy_item.data.damage.parts;\n                    let wpSaveA = copy_item.data.save.ability;\n                    let wpSaveDC = copy_item.data.save.dc;\n                    let wpSaveS = copy_item.data.save.scaling;\n                    target.actor.setFlag(`world`, `venenoBasico`, {\n                        weapon: itemId,\n                        weaponDmg: wpDamage,\n                        weaponA: wpSaveA,\n                        weaponDC: wpSaveDC,\n                        weaponS: wpSaveS,\n                    }\n                    );\n                    copy_item.data.damage.parts.push([\"1d4\", \"poison\"]);\n                    copy_item.data.save.ability = \"con\";\n                    copy_item.data.save.dc = 10;\n                    copy_item.data.save.scaling = \"flat\";\n                    target.actor.updateEmbeddedEntity(\"OwnedItem\", copy_item);\n                }\n            },\n            Cancel:\n            {\n                label: `Cancelar`\n            }\n        }\n    }).render(true);\n}\n\n//Revert weapon and unset flag.\nif (args[0] === \"off\") {\n    let { damage, weapon, weaponDmg } = target.actor.getFlag('world', 'venenoBasico');\n    let item = target.actor.items.get(weapon);\n    let copy_item = duplicate(item);\n    copy_item.data.damage.parts = weaponDmg;\n    if (typeof weaponA == 'undefined') copy_item.data.save.ability = \"\"; else copy_item.data.save.ability = weaponA;\n    if (typeof weaponDC == 'undefined') copy_item.data.save.dc = \"\"; else copy_item.data.save.dc = weaponDC;\n    if (typeof weaponS == 'undefined') copy_item.data.save.scaling = \"spell\"; else copy_item.data.save.scaling = weaponS;\n    target.actor.updateEmbeddedEntity(\"OwnedItem\", copy_item);\n    target.actor.unsetFlag(`world`, `venenoBasico`);\n}","author":"pBwbFiG4dBGPbe9o","img":"systems/dnd5e/icons/items/potions/minor-green.jpg","actorIds":[]}
{"_id":"5bFG4umwLjPiOhya","name":"BlindExecute","permission":{"default":0,"WEA9QcckcU0S7gTI":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":true},"core":{"sourceId":"Macro.pbwtxuz3PnYmu8sB"},"cf":{"id":"temp_96l9k5fzhdo"}},"scope":"global","command":"let target = canvas.tokens.get(args[1]);\nlet ActorSetFlag = game.macros.getName(\"ActorSetFlag\");\nlet ActorUnSetFlag = game.macros.getName(\"ActorUnSetFlag\");\n\n\nif (args[2] === 1){\n    game.cub.addCondition(args[0], target)\n    let flag = \"DE \" + args[0]\n    ActorSetFlag.execute(args[1], 'world', flag, 1)\n    ChatMessage.create({content: target.name + \" ha sido \" + args[0]})\n} if(args[2] === 2){\n        let flag = \"DE \" + args[0]\n        game.cub.removeCondition(args[0], target);\n        ChatMessage.create({content: target.name + \" ya no está \" + args[0]})\n        ActorUnSetFlag.execute(args[1], 'world', flag)\n    }","author":"WEA9QcckcU0S7gTI","img":"icons/svg/dice-target.svg","actorIds":[]}
{"_id":"A9xHe1dDBzjirh6N","name":"MacroAliento de Dragón","permission":{"default":0,"WEA9QcckcU0S7gTI":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.SlQPN9cea6VW9R5d"},"cf":{"id":"temp_96l9k5fzhdo","path":"Macros Conjuros","color":"#800000","import":null}},"scope":"global","command":"//DAE Macro Execute, Effect Value = \"Macro Name\" @target @item.level\n\nlet target = canvas.tokens.get(args[1])\nlet damage_content = ``;\nlet data = {}\n\n//ácido, frío, fuego, relámpago o veneno\n\ndamage_content += `<option value=\"acid\">Ácido</option>`;\ndamage_content += `<option value=\"cold\">Frío</option>`;\ndamage_content += `<option value=\"fire\">Fuego</option>`;\ndamage_content += `<option value=\"lighthing\">Relámpago</option>`;\ndamage_content += `<option value=\"poison\">Veneno</option>`;\n\n\n\n/**\n * Create Flame Blade item in inventory\n */\nif (args[0] === \"on\") {\n  let weaponDamge = 1 + args[2];\n  let content = `\n    <div class=\"form-group\">\n    <label>Tipo de Daño: </label>\n    <select name=\"damages\">\n        ${damage_content}\n        </select>\n    </div>`;\n\n    new Dialog({\n        content,\n        buttons:\n        {\n            Ok:\n            {\n                label: `Okey`,\n                callback: (html) => {\n                    let danio = html.find('[name=damages]')[0].value;\n                    (async function(){\n                    await target.actor.createOwnedItem(\n                    {\n                    \"name\": \"Aliento de Dragón\",\n                    \"type\": \"feat\",\n                    \"data\": {\n                        \"quantity\": 1,\n                        \"activation\": {\n                            \"type\": \"action\",\n                            \"cost\": 1,\n                            \"condition\": \"\"\n                        },\n                        \"duration\": {\n                            \"value\": null,\n                            \"units\": \"\"\n                        },\n                        \"target\": {\n                            \"value\": 15,\n                            \"width\": null,\n                            \"units\": \"ft\",\n                            \"type\": \"cone\"\n                        },\n                        \"range\": {\n                            \"value\": null,\n                            \"long\": null,\n                            \"units\": \"self\"\n                        },\n                        \"uses\": {\n                            \"value\": 0,\n                            \"max\": 0,\n                            \"per\": \"\"\n                        },\n                        \"consume\": {\n                            \"type\": \"\",\n                            \"target\": \"\",\n                            \"amount\": null\n                        },\n                        \"ability\": \"\",\n                        \"actionType\": \"save\",\n                        \"attackBonus\": \"0\",\n                        \"chatFlavor\": \"\",\n                        \"critical\": null,\n                        \"damage\": {\n                            \"parts\": [\n                                [\n                                    `${weaponDamge}d6`,\n                                    `${danio}`\n                                ]\n                            ],\n                            \"versatile\": \"\"\n                        },\n                        \"save\": {\n                            \"ability\": \"dex\",\n                            \"dc\": null,\n                            \"scaling\": \"spell\"\n                        },\n                        \"weaponType\": \"simpleM\",\n                        \"proficient\": true,\n                    },\n                    \"img\": \"systems/dnd5e/icons/spells/beam-orange-2.jpg\",\n                    }\n                );})();\n                }\n            },\n            Cancel:\n            {\n                label: `Cancelar`\n            }\n        }\n    }).render(true);\n\n  \n}\n\n// Delete Flame Blade\nif (args[0] === \"off\") {\n  let item = target.actor.data.items.find(i => i.name === \"Aliento de Dragón\" && i.type === \"feat\")\n  target.actor.deleteOwnedItem(item._id)\n}","author":"WEA9QcckcU0S7gTI","img":"systems/dnd5e/icons/spells/beam-orange-2.jpg","actorIds":[]}
{"_id":"BMJTInymS9vYNWPr","name":"MacroCastigo Atronador","permission":{"default":0,"WEA9QcckcU0S7gTI":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.6avU8avuuue4Q8hE"},"cf":{"id":"temp_96l9k5fzhdo"}},"scope":"global","command":"//DAE Macro Execute, Effect Value = \"Macro Name\" @target\n\nlet target = canvas.tokens.get(args[1]);\nlet weapons = target.actor.items.filter(i => i.data.type === `weapon`);\nlet weapon_content = ``;\n\n//Filter for weapons\nfor (let weapon of weapons) {\n    weapon_content += `<option value=${weapon.id}>${weapon.name}</option>`;\n}\n\n/**\n * Select for weapon and apply bonus based on spell level\n */\nif (args[0] === \"on\") {\n    let content = `\n    <div class=\"form-group\">\n    <label>Armas : </label>\n    <select name=\"weapons\">\n        ${weapon_content}\n        </select>\n    </div>`;\n\n    new Dialog({\n        content,\n        buttons:\n        {\n            Ok:\n            {\n                label: `Okey`,\n                callback: (html) => {\n                    let itemId = html.find('[name=weapons]')[0].value;\n                    let item = target.actor.items.get(itemId);\n                    let copy_item = duplicate(item);\n                    let wpDamage = copy_item.data.damage.parts;\n                    let wpSaveA = copy_item.data.save.ability;\n                    let wpSaveS = copy_item.data.save.scaling;\n                    target.actor.setFlag(`world`, `castigoAtronador`, {\n                        weapon: itemId,\n                        weaponDmg: wpDamage,\n                        weaponA: wpSaveA,\n                        weaponS: wpSaveS,\n                    }\n                    );\n                    copy_item.data.damage.parts.push([\"2d6\", \"thunder\"]);\n                    copy_item.data.save.ability = \"str\";\n                    copy_item.data.save.scaling = \"spell\";\n                    target.actor.updateEmbeddedEntity(\"OwnedItem\", copy_item);\n                }\n            },\n            Cancel:\n            {\n                label: `Cancelar`\n            }\n        }\n    }).render(true);\n}\n\n//Revert weapon and unset flag.\nif (args[0] === \"off\") {\n    let { damage, weapon, weaponDmg } = target.actor.getFlag('world', 'castigoAtronador');\n    let item = target.actor.items.get(weapon);\n    let copy_item = duplicate(item);\n    copy_item.data.damage.parts = weaponDmg;\n    if (typeof weaponA == 'undefined') copy_item.data.save.ability = \"\"; else copy_item.data.save.ability = weaponA;\n    if (typeof weaponS == 'undefined') copy_item.data.save.scaling = \"spell\"; else copy_item.data.save.scaling = weaponS;\n    target.actor.updateEmbeddedEntity(\"OwnedItem\", copy_item);\n    target.actor.unsetFlag(`world`, `castigoAtronador`);\n}","author":"WEA9QcckcU0S7gTI","img":"systems/dnd5e/icons/spells/enchant-sky-2.jpg","actorIds":[]}
{"_id":"CSea82WntKaihmMR","name":"Token Vision Configuration","permission":{"default":0,"WEA9QcckcU0S7gTI":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"core":{"sourceId":"Macro.EEtcn2YTDD75B7HU"},"furnace":{"runAsGM":false}},"scope":"global","command":"// A macro for the Foundry virtual tabletop that lets a user configure their token's vision and lighting settings. This script is taken from Sky's foundry repo here: https://github.com/Sky-Captain-13/foundry/blob/master/scriptMacros/tokenVision.js.\n\nlet applyChanges = false;\nnew Dialog({\n  title: `Token Vision Configuration`,\n  content: `\n    <form>\n      <div class=\"form-group\">\n        <label>Vision Type:</label>\n        <select id=\"vision-type\" name=\"vision-type\">\n          <option value=\"nochange\">No Change</option>\n          <option value=\"dim0\">Self</option>\n          <option value=\"dim30\">Darkvision (30 ft)</option>\n          <option value=\"dim60\">Darkvision (60 ft)</option>\n          <option value=\"dim90\">Darkvision (90 ft)</option>\n          <option value=\"dim120\">Darkvision (120 ft)</option>\n          <option value=\"dim150\">Darkvision (150 ft)</option>\n          <option value=\"dim180\">Darkvision (180 ft)</option>\n          <option value=\"bright120\">Devil's Sight (Warlock)</option>\n        </select>\n      </div>\n      <div class=\"form-group\">\n        <label>Light Source:</label>\n        <select id=\"light-source\" name=\"light-source\">\n          <option value=\"nochange\">No Change</option>\n          <option value=\"none\">None</option>\n          <option value=\"candle\">Candle</option>\n          <option value=\"lamp\">Lamp</option>\n          <option value=\"bullseye\">Lantern (Bullseye)</option>\n          <option value=\"hooded-dim\">Lantern (Hooded - Dim)</option>\n          <option value=\"hooded-bright\">Lantern (Hooded - Bright)</option>\n          <option value=\"light\">Light (Cantrip)</option>\n          <option value=\"torch\">Torch</option>\n        </select>\n      </div>\n    </form>\n    `,\n  buttons: {\n    yes: {\n      icon: \"<i class='fas fa-check'></i>\",\n      label: `Apply Changes`,\n      callback: () => applyChanges = true\n    },\n    no: {\n      icon: \"<i class='fas fa-times'></i>\",\n      label: `Cancel Changes`\n    },\n  },\n  default: \"yes\",\n  close: html => {\n    if (applyChanges) {\n      for ( let token of canvas.tokens.controlled ) {\n        let visionType = html.find('[name=\"vision-type\"]')[0].value || \"none\";\n        let lightSource = html.find('[name=\"light-source\"]')[0].value || \"none\";\n        let dimSight = 0;\n        let brightSight = 0;\n        let dimLight = 0;\n        let brightLight = 0;\n        let lightAngle = 360;\n        let lockRotation = token.data.lockRotation;\n        // Get Vision Type Values\n        switch (visionType) {\n          case \"dim0\":\n            dimSight = 0;\n            brightSight = 0;\n            break;\n          case \"dim30\":\n            dimSight = 30;\n            brightSight = 0;\n            break;\n          case \"dim60\":\n            dimSight = 60;\n            brightSight = 0;\n            break;\n          case \"dim90\":\n            dimSight = 90;\n            brightSight = 0;\n            break;\n          case \"dim120\":\n            dimSight = 120;\n            brightSight = 0;\n            break;\n          case \"dim150\":\n            dimSight = 150;\n            brightSight = 0;\n            break;\n          case \"dim180\":\n            dimSight = 180;\n            brightSight = 0;\n            break;\n          case \"bright120\":\n            dimSight = 0;\n            brightSight= 120;\n            break;\n          case \"nochange\":\n          default:\n            dimSight = token.data.dimSight;\n            brightSight = token.data.brightSight;\n        }\n        // Get Light Source Values\n        switch (lightSource) {\n          case \"none\":\n            dimLight = 0;\n            brightLight = 0;\n            break;\n          case \"candle\":\n            dimLight = 10;\n            brightLight = 5;\n            break;\n          case \"lamp\":\n            dimLight = 45;\n            brightLight = 15;\n            break;\n          case \"bullseye\":\n            dimLight = 120;\n            brightLight = 60;\n            lockRotation = false;\n            lightAngle = 52.5;\n            break;\n          case \"hooded-dim\":\n            dimLight = 5;\n            brightLight = 0;\n            break;\n          case \"hooded-bright\":\n            dimLight = 60;\n            brightLight = 30;\n            break;\n          case \"light\":\n            dimLight = 40;\n            brightLight = 20;\n            break;\n          case \"torch\":\n            dimLight = 40;\n            brightLight = 20;\n            break;\n          case \"nochange\":\n          default:\n            dimLight = token.data.dimLight;\n            brightLight = token.data.brightLight;\n            lightAngle = token.data.lightAngle;\n            lockRotation = token.data.lockRotation;\n        }\n        // Update Token\n        console.log(token);\n        token.update({\n          vision: true,\n          dimSight: dimSight,\n          brightSight: brightSight,\n          dimLight: dimLight,\n          brightLight:  brightLight,\n          lightAngle: lightAngle,\n          lockRotation: lockRotation\n        });\n      }\n    }\n  }\n}).render(true);","author":"WEA9QcckcU0S7gTI","img":"modules/SharedData/icons/skills/skills1_0009_Layer-10.png","actorIds":[]}
{"_id":"HnYT8kWsWK1QGQ5M","name":"MacroCastigo Abrasador","permission":{"default":0,"WEA9QcckcU0S7gTI":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.6avU8avuuue4Q8hE"},"cf":{"id":"temp_96l9k5fzhdo"}},"scope":"global","command":"//DAE Macro Execute, Effect Value = \"Macro Name\" @target\n\nlet target = canvas.tokens.get(args[1]);\nlet weapons = target.actor.items.filter(i => i.data.type === `weapon`);\nlet weapon_content = ``;\n\n//Filter for weapons\nfor (let weapon of weapons) {\n    weapon_content += `<option value=${weapon.id}>${weapon.name}</option>`;\n}\n\n/**\n * Select for weapon and apply bonus based on spell level\n */\nif (args[0] === \"on\") {\n    let content = `\n    <div class=\"form-group\">\n    <label>Armas : </label>\n    <select name=\"weapons\">\n        ${weapon_content}\n        </select>\n    </div>`;\n\n    new Dialog({\n        content,\n        buttons:\n        {\n            Ok:\n            {\n                label: `Okey`,\n                callback: (html) => {\n                    let itemId = html.find('[name=weapons]')[0].value;\n                    let item = target.actor.items.get(itemId);\n                    let copy_item = duplicate(item);\n                    let wpDamage = copy_item.data.damage.parts;\n                    target.actor.setFlag(`world`, `castigoAbrasador`, {\n                        weapon: itemId,\n                        weaponDmg: wpDamage,\n                    }\n                    );\n                    copy_item.data.damage.parts.push([args[2] + \"d6\", \"fire\"]);\n                    target.actor.updateEmbeddedEntity(\"OwnedItem\", copy_item);\n                }\n            },\n            Cancel:\n            {\n                label: `Cancelar`\n            }\n        }\n    }).render(true);\n}\n\n//Revert weapon and unset flag.\nif (args[0] === \"off\") {\n    let { damage, weapon, weaponDmg } = target.actor.getFlag('world', 'castigoAbrasador');\n    let item = target.actor.items.get(weapon);\n    let copy_item = duplicate(item);\n    copy_item.data.damage.parts = weaponDmg;\n    target.actor.updateEmbeddedEntity(\"OwnedItem\", copy_item);\n    target.actor.unsetFlag(`world`, `castigoAbrasador`);\n}","author":"WEA9QcckcU0S7gTI","img":"systems/dnd5e/icons/spells/enchant-orange-2.jpg","actorIds":[]}
{"_id":"Jpx8icltaYpemilS","name":"MacroArma Magica","permission":{"default":0,"WEA9QcckcU0S7gTI":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.6avU8avuuue4Q8hE"},"cf":{"id":"temp_96l9k5fzhdo","path":"Macros Conjuros","color":"#800000"}},"scope":"global","command":"//DAE Macro Execute, Effect Value = \"Macro Name\" @target\n\nlet target = canvas.tokens.get(args[1]);\nlet weapons = target.actor.items.filter(i => i.data.type === `weapon`);\nlet weapon_content = ``;\nfunction value_limit(val, min, max) {\n    return val < min ? min : (val > max ? max : val);\n}\n\n//Filter for weapons\nfor (let weapon of weapons) {\n    weapon_content += `<option value=${weapon.id}>${weapon.name}</option>`;\n}\n\n/**\n * Select for weapon and apply bonus based on spell level\n */\nif (args[0] === \"on\") {\n    let content = `\n    <div class=\"form-group\">\n    <label>Armas : </label>\n    <select name=\"weapons\">\n        ${weapon_content}\n        </select>\n    </div>`;\n\n    new Dialog({\n        content,\n        buttons:\n        {\n            Ok:\n            {\n                label: `Okey`,\n                callback: (html) => {\n                    let itemId = html.find('[name=weapons]')[0].value;\n                    let item = target.actor.items.get(itemId);\n                    let copy_item = duplicate(item);\n                    let spellLevel = Math.floor(args[2] / 2);\n                    let bonus = value_limit(spellLevel, 1, 3);\n                    let wpDamage = copy_item.data.damage.parts[0][0];\n                    target.actor.setFlag(`world`, `magicWeapon`, {\n                        damage: item.data.attackBonus,\n                        weapon: itemId,\n                        weaponDmg: wpDamage,\n                    }\n                    );\n                    copy_item.data.attackBonus = (copy_item.data.attackBonus + bonus);\n                    copy_item.data.damage.parts[0][0] = (wpDamage + \" + \" + bonus);\n                    target.actor.updateEmbeddedEntity(\"OwnedItem\", copy_item);\n                }\n            },\n            Cancel:\n            {\n                label: `Cancelar`\n            }\n        }\n    }).render(true);\n}\n\n//Revert weapon and unset flag.\nif (args[0] === \"off\") {\n    let { damage, weapon, weaponDmg } = target.actor.getFlag('world', 'magicWeapon');\n    let item = target.actor.items.get(weapon);\n    let copy_item = duplicate(item);\n    copy_item.data.attackBonus = (copy_item.data.attackBonus - damage);\n    copy_item.data.damage.parts[0][0] = weaponDmg;\n    target.actor.updateEmbeddedEntity(\"OwnedItem\", copy_item);\n    target.actor.unsetFlag(`world`, `magicWeapon`);\n}","author":"WEA9QcckcU0S7gTI","img":"systems/dnd5e/icons/spells/enchant-blue-2.jpg","actorIds":[]}
{"_id":"KHy1UhFDSZ1xMkay","name":"#[CF_tempEntity]","permission":{"default":0,"WEA9QcckcU0S7gTI":3},"type":"chat","flags":{"cf":{"id":"temp_96l9k5fzhdo","path":"Macros Conjuros","color":"#800000","name":"Macros Conjuros/Armas","children":["2tmNi2sQaJW8tGrW"],"folderPath":[],"icon":""}},"scope":"global","command":"","author":"WEA9QcckcU0S7gTI","img":"icons/svg/dice-target.svg","actorIds":[]}
{"_id":"Kfoylmv1XeoMCVfE","name":"MacroShillelagh","permission":{"default":0,"WEA9QcckcU0S7gTI":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.cslIZHQ9ILsUGEMj"},"cf":{"id":"temp_96l9k5fzhdo","path":"Macros Conjuros","color":"#800000"}},"scope":"global","command":"let target = canvas.tokens.get(args[1]);\nlet weapons = target.actor.items.filter(i => i.data.type === `weapon`);\nlet weapon_content = ``;\n\nfor (let weapon of weapons) {\n    weapon_content += `<option value=${weapon.id}>${weapon.name}</option>`;\n}\nif (args[0] === \"on\" && !target.getFlag('world', 'shillelagh')) {\n    let content = `\n<div class=\"form-group\">\n  <label>Armas : </label>\n  <select name=\"weapons\">\n    ${weapon_content}\n  </select>\n</div>`;\n\n    new Dialog({\n        title: \"Elige un bastón o garrote.\",\n        content,\n        buttons:\n        {\n            Ok:\n            {\n                label: `Ok`,\n                callback: (html) => {\n                    let itemId = html.find('[name=weapons]')[0].value;\n                    let item = target.actor.items.get(itemId);\n                    let copy_item = duplicate(item);\n                    target.actor.setFlag(`world`, `shillelagh`, {\n                        id : itemId,\n                        damage : copy_item.data.damage.parts[0][0]    \n                    });\n                    let damage = copy_item.data.damage.parts[0][0];\n                    var newdamage = damage.replace(/1d(4|6)/g,\"1d8\");\n                    copy_item.data.damage.parts[0][0] = newdamage;\n                    copy_item.data.ability = \"wis\";\n                    target.actor.updateEmbeddedEntity(\"OwnedItem\", copy_item);\n                    ChatMessage.create({content: copy_item.name + \" esta mejorado\"});\n                }\n            },\n            Cancel:\n            {\n                label: `Cancelar`\n            }\n        }\n    }).render(true);\n}\n\nif (args[0] === \"off\") {\n    let flag = target.actor.getFlag(`world`, `shillelagh`);\n    let itemId = flag.id;\n    let damage = flag.damage;\n    let item = target.actor.items.get(itemId);\n    let copy_item = duplicate(item);\n    copy_item.data.damage.parts[0][0] = damage;\n    copy_item.data.ability = \"\";\n    target.actor.updateEmbeddedEntity(\"OwnedItem\", copy_item);\n    target.actor.unsetFlag(`world`, `shillelagh`);\n    ChatMessage.create({content: copy_item.name + \" vuelve a su estado normal\"});\n\n}","author":"WEA9QcckcU0S7gTI","img":"systems/dnd5e/icons/spells/enchant-jade-1.jpg","actorIds":[]}
{"_id":"MzCMArcseDRI0PkM","name":"MacroCastigo Furioso","permission":{"default":0,"WEA9QcckcU0S7gTI":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.6avU8avuuue4Q8hE"},"cf":{"id":"temp_96l9k5fzhdo"}},"scope":"global","command":"//DAE Macro Execute, Effect Value = \"Macro Name\" @target\n\nlet target = canvas.tokens.get(args[1]);\nlet weapons = target.actor.items.filter(i => i.data.type === `weapon`);\nlet weapon_content = ``;\n\n//Filter for weapons\nfor (let weapon of weapons) {\n    weapon_content += `<option value=${weapon.id}>${weapon.name}</option>`;\n}\n\n/**\n * Select for weapon and apply bonus based on spell level\n */\nif (args[0] === \"on\") {\n    let content = `\n    <div class=\"form-group\">\n    <label>Armas : </label>\n    <select name=\"weapons\">\n        ${weapon_content}\n        </select>\n    </div>`;\n\n    new Dialog({\n        content,\n        buttons:\n        {\n            Ok:\n            {\n                label: `Okey`,\n                callback: (html) => {\n                    let itemId = html.find('[name=weapons]')[0].value;\n                    let item = target.actor.items.get(itemId);\n                    let copy_item = duplicate(item);\n                    let wpDamage = copy_item.data.damage.parts;\n                    let wpSaveA = copy_item.data.save.ability;\n                    let wpSaveS = copy_item.data.save.scaling;\n                    target.actor.setFlag(`world`, `castigoFurioso`, {\n                        weapon: itemId,\n                        weaponDmg: wpDamage,\n                        weaponA: wpSaveA,\n                        weaponS: wpSaveS,\n                    }\n                    );\n                    copy_item.data.damage.parts.push([\"1d6\", \"psychic\"]);\n                    copy_item.data.save.ability = \"wis\";\n                    copy_item.data.save.scaling = \"spell\";\n                    target.actor.updateEmbeddedEntity(\"OwnedItem\", copy_item);\n                }\n            },\n            Cancel:\n            {\n                label: `Cancelar`\n            }\n        }\n    }).render(true);\n}\n\n//Revert weapon and unset flag.\nif (args[0] === \"off\") {\n    let { damage, weapon, weaponDmg } = target.actor.getFlag('world', 'castigoFurioso');\n    let item = target.actor.items.get(weapon);\n    let copy_item = duplicate(item);\n    copy_item.data.damage.parts = weaponDmg;\n    if (typeof weaponA == 'undefined') copy_item.data.save.ability = \"\"; else copy_item.data.save.ability = weaponA;\n    if (typeof weaponS == 'undefined') copy_item.data.save.scaling = \"spell\"; else copy_item.data.save.scaling = weaponS;\n    target.actor.updateEmbeddedEntity(\"OwnedItem\", copy_item);\n    target.actor.unsetFlag(`world`, `castigoFurioso`);\n}","author":"WEA9QcckcU0S7gTI","img":"systems/dnd5e/icons/spells/enchant-red-2.jpg","actorIds":[]}
{"name":"Activar/Desactivar Visión de Token","permission":{"default":0,"WEA9QcckcU0S7gTI":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"core":{"sourceId":"Macro.EEtcn2YTDD75B7HU"},"furnace":{"runAsGM":false}},"scope":"global","command":"for ( let token of canvas.tokens.controlled ) {\n    let vision = true;\n    if(token.data.vision === true)\n        vision = false;\n    else\n        vision = true;\n    token.update({vision: vision});\n}","author":"WEA9QcckcU0S7gTI","img":"icons/svg/blind.svg","actorIds":[],"_id":"NRhCv9BXOC46kItK"}
{"_id":"PIJ6NwxQyRu1NB9P","name":"TokenUpdate","permission":{"default":0,"WEA9QcckcU0S7gTI":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":true},"cf":{"id":"temp_96l9k5fzhdo","path":"Macros Conjuros","color":"#800000"}},"scope":"global","command":"//args[0] = token ID\r\n//args[1] = update data\r\n\r\nif(!args[0] || !args[1]) return ui.notifications.error(`${this.name}'s arguments are invalid.`);\r\n\r\ncanvas.tokens.get(args[0]).update(args[1]);","author":"WEA9QcckcU0S7gTI","img":"icons/svg/dice-target.svg","actorIds":[]}
{"_id":"PiwDGAe7AAHtL0JV","name":"MacroAgrandarReducir","permission":{"default":0,"WEA9QcckcU0S7gTI":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.tKKbvoCkf5A37rsc"},"cf":{"id":"temp_96l9k5fzhdo","path":"Macros Conjuros","color":"#800000"}},"scope":"global","command":"let target = canvas.tokens.get(args[1]);\nlet originalSize = target.data.width;\nlet mwak = target.actor.data.data.bonuses.mwak.damage\nlet ActorUpdate = game.macros.getName(\"ActorUpdate\");\nlet TokenUpdate = game.macros.getName(\"TokenUpdate\");\nlet ActorSetFlag = game.macros.getName(\"ActorSetFlag\");\nlet ActorUnSetFlag = game.macros.getName(\"ActorUnSetFlag\");\nif (args[0] === \"on\" && !target.getFlag('world', 'enlageReduceSpell')) {\n    if (target) {\n        new Dialog({\n            title: \"¿Agrandar o Reducir?\",\n            buttons: {\n                one: {\n                    label: \"Agrandar\",\n                    callback: () => {\n                        let bonus = mwak + \" 1d4\";\n                        let enlarge = (originalSize + 1);\n                        ActorUpdate.execute(args[1],{\"data.bonuses.mwak.damage\" : bonus });\n                        TokenUpdate.execute(args[1],{\"width\": enlarge, \"height\": enlarge});\n                        ActorSetFlag.execute(args[1], 'world', 'enlageReduceSpell', {\n                            size: originalSize,\n                            ogMwak: mwak,\n                        })\n                        ChatMessage.create({content: target.name + \" se agranda\"})\n                    }\n                },\n                    two: {\n                        label: \"Reducir\",\n                        callback: () => {\n                        let bonus = mwak +  \" -1d4\";\n                        let size = originalSize\n                        let newSize = (size > 1) ? (size -1) : (size - 0.3)\n                        ActorUpdate.execute(args[1],{\"data.bonuses.mwak.damage\" : bonus });\n                        TokenUpdate.execute(args[1],{\"width\": newSize, \"height\": newSize});\n                        ActorSetFlag.execute(args[1], 'world', 'enlageReduceSpell', {\n                            size : originalSize,\n                            ogMwak : mwak,\n                        })\n                        ChatMessage.create({content: target.name + \" se reduce\"})\n                        }\n                },\n            }\n        }).render(true);\n    }\n} else if(args[0] === \"off\"){\n    let flag = target.actor.getFlag('world', 'enlageReduceSpell')\n    ActorUpdate.execute(args[1],{\"data.bonuses.mwak.damage\" : flag.ogMwak })\n    TokenUpdate.execute(args[1],{\"width\": flag.size, \"height\": flag.size});\n    ActorUnSetFlag.execute(args[1], 'world', 'enlageReduceSpell')\n    ChatMessage.create({content: target.name + \" vuelve a su tamaño normal\"})\n}","author":"WEA9QcckcU0S7gTI","img":"systems/dnd5e/icons/spells/link-blue-2.jpg","actorIds":[]}
{"name":"Hide Estimate","type":"script","author":"QvaUXUrU6tmovYhg","img":"icons/svg/cowled.svg","scope":"global","command":"/**\n*  This macro will hide the Health Estimate from selected tokens.\n*/\n\nfor (let e of canvas.tokens.controlled) {\n\tlet hidden = !e.document.getFlag(\"healthEstimate\", \"hideHealthEstimate\");\n\te.document.setFlag(\"healthEstimate\", \"hideHealthEstimate\", hidden)\n\tif (hidden) ui.notifications.info(`${e.actor.data.name}'s health estimate is hidden from players.`);\n\telse ui.notifications.info(`${e.actor.data.name}'s health estimate is shown to players.`);\n}","folder":null,"sort":0,"permission":{"default":0,"QvaUXUrU6tmovYhg":3},"flags":{"core":{"sourceId":"Macro.f1dST0uSVk2pCby1"}},"_id":"TWrToeQ5Ul3miXjO"}
{"_id":"YWEYGqbDdRIlev94","name":"ActorSetFlag","permission":{"default":0,"WEA9QcckcU0S7gTI":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":true},"cf":{"id":"temp_96l9k5fzhdo","path":"Macros Conjuros","color":"#800000"}},"scope":"global","command":"//args[0] = token ID\r\n//args[1]-[3] = update data\r\n\r\nif(!args[0] || !args[1]) return ui.notifications.error(`${this.name}'s arguments are invalid.`);\r\n\r\ncanvas.tokens.get(args[0]).actor.setFlag(args[1], args[2], args[3]);\r\n\r\n","author":"WEA9QcckcU0S7gTI","img":"icons/svg/dice-target.svg","actorIds":[]}
{"_id":"ZNqlUAi4fPWNiZXl","name":"MacroHoja de Sombra","permission":{"default":0,"WEA9QcckcU0S7gTI":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.SlQPN9cea6VW9R5d"},"cf":{"id":"temp_96l9k5fzhdo","path":"Macros Conjuros","color":"#800000"}},"scope":"global","command":"//DAE Macro Execute, Effect Value = \"Macro Name\" @target @item.level\n\nlet target = canvas.tokens.get(args[1])\nlet data = {}\n/**\n * Create Flame Blade item in inventory\n */\nif (args[0] === \"on\") {\n  let weaponDamge = 1 + Math.ceil(args[2] / 2);\n  if(weaponDamge == 6) weaponDamge = 5;\n  await target.actor.createOwnedItem(\n    {\n      \"name\": \"Hoja de Sombra Invocada\",\n      \"type\": \"weapon\",\n      \"data\": {\n        \"quantity\": 1,\n        \"activation\": {\n          \"type\": \"action\",\n          \"cost\": 1,\n          \"condition\": \"\"\n        },\n        \"duration\": {\n          \"value\": null,\n          \"units\": \"\"\n        },\n        \"target\": {\n          \"value\": 1,\n          \"width\": null,\n          \"units\": \"\",\n          \"type\": \"creature\"\n        },\n        \"range\": {\n          \"value\": 20,\n          \"long\": 60,\n          \"units\": \"ft\"\n        },\n        \"uses\": {\n          \"value\": 0,\n          \"max\": 0,\n          \"per\": \"\"\n        },\n        \"consume\": {\n          \"type\": \"\",\n          \"target\": \"\",\n          \"amount\": null\n        },\n        \"ability\": \"\",\n        \"actionType\": \"msak\",\n        \"attackBonus\": \"0\",\n        \"chatFlavor\": \"\",\n        \"critical\": null,\n        \"damage\": {\n          \"parts\": [\n            [\n              `${weaponDamge}d8`,\n              \"psychic\"\n            ]\n          ],\n          \"versatile\": \"\"\n        },\n        \"weaponType\": \"simpleM\",\n        \"proficient\": true,\n        \"properties\": {\n            \"fin\": true,\n            \"lgt\": true,\n            \"thr\": true,\n            \"amm\": false,\n            \"hvy\": false,\n            \"fir\": false,\n            \"foc\": false,\n            \"lod\": false,\n            \"rch\": false,\n            \"rel\": false,\n            \"ret\": false,\n            \"spc\": false,\n            \"two\": false,\n            \"ver\": false,\n            \"mgc\": false,\n            \"nodam\": false,\n            \"faulldam\": false\n        },\n      },\n      \"img\": \"modules/SharedData/icons/skills/skills2_0086_Layer-87.png\",\n    }\n  );\n}\n\n// Delete Flame Blade\nif (args[0] === \"off\") {\n  let item = target.actor.data.items.find(i => i.name === \"Hoja de Sombra Invocada\" && i.type === \"weapon\")\n  target.actor.deleteOwnedItem(item._id)\n}","author":"WEA9QcckcU0S7gTI","img":"modules/SharedData/icons/skills/skills2_0086_Layer-87.png","actorIds":[]}
{"name":"Teleport","type":"script","author":"QvaUXUrU6tmovYhg","img":"icons/svg/circle.svg","scope":"global","command":"DAE.teleportToToken(token, args[0], args[1], args[2])","folder":null,"sort":0,"permission":{"default":0,"QvaUXUrU6tmovYhg":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.bjxKF6Zb3ADTWYkI"}},"_id":"ZV6SQCpGIjzXQPE2"}
{"_id":"Zwhf3gm3n0gsehDa","name":"MacroSorderaCeguera","permission":{"default":0,"WEA9QcckcU0S7gTI":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.oiEgd0VHxlxJZsWN"},"cf":{"id":"temp_96l9k5fzhdo"}},"scope":"global","command":"let target = canvas.tokens.get(args[1]);\nif (args[0] === \"on\") {\n    new Dialog({\n        title: \"Elige un efecto\",\n        buttons: {\n            one: {\n                label: \"Ceguera\",\n                callback: () => {\n                    game.macros.getName(\"BlindExecute\").execute(\"Cegado\", args[1], 1 )\n                }\n            },\n            two: {\n                label: \"Sordera\",\n                callback: () => {\n                    game.macros.getName(\"BlindExecute\").execute(\"Ensordecido\", args[1], 1 )\n                }\n            }\n        },\n    }).render(true);\n}\nif(args[0] === \"off\"){\n    if (target.actor.getFlag('world', 'DE Blinded')) {\n        game.macros.getName(\"BlindExecute\").execute(\"Blinded\", args[1], 2 )\n    } else if (target.actor.getFlag('world', 'DE Deafened')) {\n        game.macros.getName(\"BlindExecute\").execute(\"Deafened\", args[1], 2 )\n    }\n}","author":"WEA9QcckcU0S7gTI","img":"systems/dnd5e/icons/spells/evil-eye-red-2.jpg","actorIds":[]}
{"name":"Eliminar efectos temporales","permission":{"default":0,"WEA9QcckcU0S7gTI":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.vsXjrg8oqr4dKdD5"}},"scope":"global","command":"for( let effect of token.actor.effects){\n    if(effect.isTemporary === true){\n        effect.delete();\n      }\n}","author":"WEA9QcckcU0S7gTI","img":"modules/SharedData/icons/skills/skills-unique-_07.png","actorIds":[],"_id":"bqo7exb0UhWVjT3r"}
{"_id":"e6SsAKhGILL1ucYE","name":"MacroCastigo Marcador","permission":{"default":0,"WEA9QcckcU0S7gTI":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.6avU8avuuue4Q8hE"},"cf":{"id":"temp_96l9k5fzhdo"}},"scope":"global","command":"//DAE Macro Execute, Effect Value = \"Macro Name\" @target\n\nlet target = canvas.tokens.get(args[1]);\nlet weapons = target.actor.items.filter(i => i.data.type === `weapon`);\nlet weapon_content = ``;\n\n//Filter for weapons\nfor (let weapon of weapons) {\n    weapon_content += `<option value=${weapon.id}>${weapon.name}</option>`;\n}\n\n/**\n * Select for weapon and apply bonus based on spell level\n */\nif (args[0] === \"on\") {\n    let content = `\n    <div class=\"form-group\">\n    <label>Armas : </label>\n    <select name=\"weapons\">\n        ${weapon_content}\n        </select>\n    </div>`;\n\n    new Dialog({\n        content,\n        buttons:\n        {\n            Ok:\n            {\n                label: `Okey`,\n                callback: (html) => {\n                    let itemId = html.find('[name=weapons]')[0].value;\n                    let item = target.actor.items.get(itemId);\n                    let copy_item = duplicate(item);\n                    let wpDamage = copy_item.data.damage.parts[0][0];\n                    target.actor.setFlag(`world`, `castigoMarcador`, {\n                        weapon: itemId,\n                        weaponDmg: wpDamage,\n                    }\n                    );\n                    copy_item.data.damage.parts[0][0] = (wpDamage + \" + \" + args[2] + \"d6\");\n                    target.actor.updateEmbeddedEntity(\"OwnedItem\", copy_item);\n                }\n            },\n            Cancel:\n            {\n                label: `Cancelar`\n            }\n        }\n    }).render(true);\n}\n\n//Revert weapon and unset flag.\nif (args[0] === \"off\") {\n    let { damage, weapon, weaponDmg } = target.actor.getFlag('world', 'castigoMarcador');\n    let item = target.actor.items.get(weapon);\n    let copy_item = duplicate(item);\n    copy_item.data.damage.parts[0][0] = weaponDmg;\n    target.actor.updateEmbeddedEntity(\"OwnedItem\", copy_item);\n    target.actor.unsetFlag(`world`, `castigoMarcador`);\n}","author":"WEA9QcckcU0S7gTI","img":"systems/dnd5e/icons/spells/enchant-orange-2.jpg","actorIds":[]}
{"_id":"eytHuVv5R5785dri","name":"ActorUnSetFlag","permission":{"default":0,"WEA9QcckcU0S7gTI":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":true},"cf":{"id":"temp_96l9k5fzhdo","path":"Macros Conjuros","color":"#800000"}},"scope":"global","command":"//args[0] = token ID\r\n//args[1]-[3] = update data\r\n\r\nif(!args[0] || !args[1]) return ui.notifications.error(`${this.name}'s arguments are invalid.`);\r\n\r\ncanvas.tokens.get(args[0]).actor.unsetFlag(args[1], args[2]);\r\n","author":"WEA9QcckcU0S7gTI","img":"icons/svg/dice-target.svg","actorIds":[]}
{"name":"QuestLog","permission":{"default":0,"WEA9QcckcU0S7gTI":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.5yeluMoDncxyb1cz"}},"scope":"global","command":"QuestLog.render(true);","author":"WEA9QcckcU0S7gTI","img":"icons/svg/book.svg","actorIds":[],"_id":"kS8NvABs3j8mhuBf"}
{"name":"Cobertura Tres Cuartos","permission":{"default":0,"WEA9QcckcU0S7gTI":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.lcOQUiQWJftrToEx"}},"scope":"global","command":"if (game.cub.hasCondition(\"Cobertura Tres Cuartos\")) {\n    game.cub.removeCondition(\"Cobertura Tres Cuartos\");\n}\nelse\n{\n    game.cub.addCondition(\"Cobertura Tres Cuartos\");\n}","author":"WEA9QcckcU0S7gTI","img":"icons/svg/combat.svg","actorIds":[],"_id":"l4xmgQX0DbMyPhmp"}
{"name":"Cobertura Media","permission":{"default":0,"WEA9QcckcU0S7gTI":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.6DiSeENSkCSoJpra"}},"scope":"global","command":"if (game.cub.hasCondition(\"Cobertura Media\")) {\n    game.cub.removeCondition(\"Cobertura Media\");\n}\nelse\n{\n    game.cub.addCondition(\"Cobertura Media\");\n}","author":"WEA9QcckcU0S7gTI","img":"icons/svg/ice-shield.svg","actorIds":[],"_id":"lNkfaB3XEi4OOv0Z"}
{"_id":"m5qRMlBI22qrwv3s","name":"CUB Condition","permission":{"default":0,"WEA9QcckcU0S7gTI":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.WdwVdMQmK7EhPkKV"},"cf":{"id":"temp_96l9k5fzhdo","path":"Macros Conjuros","color":"#800000"}},"scope":"global","command":"let target = args[2];\nif(args[0] === \"apply\"){\n    game.cub.addCondition(args[1], target)\n}\nif(args[0] === \"remove\") {\n    game.cub.removeCondition(args[1], target )\n}","author":"WEA9QcckcU0S7gTI","img":"icons/svg/dice-target.svg","actorIds":[]}
{"name":"Eliminar todas las condiciones","permission":{"default":0,"WEA9QcckcU0S7gTI":3},"type":"script","flags":{"furnace":{"runAsGM":true},"combat-utility-belt":{"macroTrigger":""},"core":{"sourceId":"Macro.9LjA4mTArE00YzDx"}},"scope":"global","command":"game.cub.removeAllConditions();","author":"WEA9QcckcU0S7gTI","img":"icons/svg/acid.svg","actorIds":[],"_id":"mKFmk6XotWCFkz7t"}
{"_id":"ns62oIJSzDVlewsC","name":"MacroHeroísmo","permission":{"default":0,"WEA9QcckcU0S7gTI":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":true},"core":{"sourceId":"Macro.Ut55MOROVVHTaZUX"},"cf":{"id":"temp_96l9k5fzhdo"}},"scope":"global","command":"//DAE Macro Execute, Effect Value = \"Macro Name\" @target @abilities.(insert casting score).mod\n\n\nlet mod = args[2];\nlet target = canvas.tokens.get(args[1]);\n\nif (args[0] === \"on\") {\n    ChatMessage.create({ content: \"Heroísmo ha sido aplicado a los objetivos.\" })\n    const hookId = Hooks.on(\"updateCombat\", (combat, update) => {\n        if (!(\"round\" in update || \"turn\" in update)) return;\n        if (combat.combatant.tokenId === args[1]) {\n            target.actor.update({ \"data.attributes.hp.temp\": mod });\n            ChatMessage.create({ content: \"Heroísmo continua en \" + target.name })\n        }\n    });\n    target.actor.setFlag(\"world\", \"heroismUpdateCombatHookId\", hookId);\n\n}\nif (args[0] === \"off\") {\n   let hookIdFlag = target.actor.getFlag(\"world\", \"heroismUpdateCombatHookId\");\n    ChatMessage.create({ content: \"Heroísmo ha terminado.\" });\n    Hooks.off(\"updateCombat\", hookIdFlag);\n    target.actor.unsetFlag(\"world\", \"heroismUpdateCombatHookId\");\n}","author":"WEA9QcckcU0S7gTI","img":"systems/dnd5e/icons/spells/heal-sky-2.jpg","actorIds":[]}
{"_id":"pYNXMQivrKxoX5vZ","name":"ActorUpdate","permission":{"default":0,"WEA9QcckcU0S7gTI":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":true},"cf":{"id":"temp_96l9k5fzhdo","path":"Macros Conjuros","color":"#800000"}},"scope":"global","command":"//args[0] = actor ID\r\n//args[1] = update data\r\n\r\nif(!args[0] || !args[1]) return ui.notifications.error(`${this.name}'s arguments are invalid.`);\r\n\r\n(async()=>{\r\n  await canvas.tokens.get(args[0]).actor.update(args[1]);\r\n})();","author":"WEA9QcckcU0S7gTI","img":"icons/svg/dice-target.svg","actorIds":[]}
{"_id":"rUivzNkbBBjMlOkc","name":"MacroLuz","permission":{"default":0,"JHjmkGj0zTCGqAw0":3},"type":"script","flags":{"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.1Wu2I3MVyieNIT7C"},"combat-utility-belt":{"macroTrigger":""},"cf":{"id":"temp_96l9k5fzhdo","path":"Macros Conjuros","color":"#800000"}},"scope":"global","command":"//DAE Macro Execute, Effect Value = \"Macro Name\" @target\nlet target = canvas.tokens.get(args[1]);\nlet dimLight = target.dimLight;\nlet brightLight = target.brightLight;\nif (args[0] === \"on\") {\n    target.actor.setFlag('world', 'lightSpell', [dimLight, brightLight]);\n    target.update({\"dimLight\" : 40,  \"brightLight\" : 20 });\n    ChatMessage.create({content: `${target.name}' emite luz.`});\n}\nif(args[0] === \"off\") {\n    let light = target.actor.getFlag('world', 'lightSpell');\n    target.update({\"dimLight\" : light[0],  \"brightLight\" : light[1] });\n    target.unsetFlag('world', 'lightSpell');\n    ChatMessage.create({content: `${target.name} dejo de emitir luz.`});\n}","author":"JHjmkGj0zTCGqAw0","img":"systems/dnd5e/icons/spells/light-sky-1.jpg","actorIds":[]}
{"_id":"vCIB5bklo8l0Zlyh","name":"ActorGetFlag","permission":{"default":0,"WEA9QcckcU0S7gTI":3},"type":"script","flags":{"furnace":{"runAsGM":false},"combat-utility-belt":{"macroTrigger":""},"core":{"sourceId":"Macro.SUOiDsbuMxlXuldC"},"cf":{"id":"temp_96l9k5fzhdo","path":"Macros Conjuros","color":"#800000"}},"scope":"global","command":"return canvas.tokens.get(args[0]).actor.getFlag(args[1], args[2]);","author":"WEA9QcckcU0S7gTI","img":"icons/svg/dice-target.svg","actorIds":[]}
{"name":"DoTrapAttack","type":"script","author":"SzRtr7FeePuN8ZT6","img":"icons/svg/net.svg","scope":"global","command":"// Requires midi-qol to work at all\n// Rolls an attack from actor args[0] using item args[1] and display a token args[2]\nlet tactor = game.actors.entities.find(a => a.name === args[0])\nif (!tactor) return `/Whisper GM \"DoTrap: Target token ${args[0]} not found\"`\nlet item = tactor.items.find(i=>  i.name === args[1])\nif (!item) return `/Whisper GM \"DoTrap: Item ${args[1]} not found\"`\nlet oldTargets = game.user.targets;\ngame.user.targets = new Set().add(token);\nlet trapToken = canvas.tokens.placeables.find(t=>t.name === args[2]);\nnew MidiQOL.TrapWorkflow(tactor, item, [token], trapToken.center)\n//Uncomment the next line if you are using conditional visibility and the CUB module to hide your traps. \n//game.cub.removeAllConditions(trapToken);\nif (trapToken) await trapToken.update({\"hidden\" : false});","folder":null,"sort":0,"permission":{"default":0,"SzRtr7FeePuN8ZT6":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.WBRzeNiWtBN7hk1I"}},"_id":"wlwHlPhbUE5XH3i8"}
{"name":"Generar Estadísticas 4d6","permission":{"default":0,"WEA9QcckcU0S7gTI":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.fBx6ojHfTcW5xj1V"}},"scope":"global","command":"/**\n * Generates character stats and outputs the table result.\n * Author: @Kekilla#7036 & KrishMero1792\n */\n \n// Formula for rolling \nconst statString = '4d6kh3';\n\n// times to roll those stats\nconst numRolls = 6;\n\n\n//////////////////////////////////////////\n// Don't touch anything below this line //\n//////////////////////////////////////////\nconst stats = Array(numRolls).fill(0).map(e=>new Roll(statString).roll());\n\nconst {faces, rolls} = stats[0].parts[0];\nconst totalAverage = (faces/2 + 0.5) * rolls.filter(i=> i?.discarded !== true).length;\nconst totalDeviation = faces/2;\nconst totalLow = Math.ceil(totalAverage - totalDeviation);\nconst totalHigh = Math.ceil(totalAverage + totalDeviation);\n\nconst header = rolls.map((roll, index) => `<th>D${index + 1}</th>`).join('');\n\nlet tableRows = '';\nlet finalSum = 0;\nfor(let {parts, total} of stats) {\n  tableRows += `<tr style=\"text-align:center\">`;\n  tableRows += parts[0].rolls.map(({result}) => `<td ${colorSetter(result, 1, faces)}>${result}</td>`).join('');\n  tableRows += `<td style=\"border-left:1px solid #000; ${colorSetter(total, totalLow, totalHigh)}\">${total}</td></tr>`;\n  finalSum += total;\n}\n\nconst colspan = `colspan=\"${rolls.length + 1}\"`;\nconst center = `text-align:center;`;\n\nlet content = `\n  <table>\n    <tr>\n      <td ${colspan}><h2 style=\"margin-bottom:0; ${center}\">Nuevas Puntuaciones de Habilidad</h2>\n      <div style=\"margin-bottom: 0.5rem; ${center}\">${statString} fueron tirados ${numRolls} veces.</div></td>\n    </tr>\n    <tr style=\"${center} border-bottom:1px solid #000\">\n      ${header}\n      <th style=\"border-left:1px solid #000\">Total</th>\n    </tr>\n    ${tableRows}\n    <tr style=\"border-top: 1px solid #000\">\n      <th colspan=\"${rolls.length}\" style=\"${center}\">Suma Final:</th>\n      <th style=\"${center}\">${finalSum}</th>\n    </tr>\n  </table>\n`;\n\n\nChatMessage.create({content});\n\nfunction colorSetter(number,low,high)\n{\n  if(number <= low) return 'color:red';\n  if(number >= high) return 'color:green';\n  return '';\n}","author":"WEA9QcckcU0S7gTI","img":"icons/svg/dice-target.svg","actorIds":[],"_id":"ySPlkZqysvr6aQZr"}
